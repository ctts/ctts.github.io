(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{353:function(n,t,e){"use strict";e.r(t);var r=e(14),s=Object(r.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h2",{attrs:{id:"图片（pdf）懒加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#图片（pdf）懒加载"}},[n._v("#")]),n._v(" 图片（pdf）懒加载")]),n._v(" "),e("p",[n._v("由于一次性渲染所有pdf会造成内存溢出，导致页面闪退，所以要使用分批加载的思想，也就是使用懒加载："),e("strong",[n._v("当视口未达到目标pdf时，不渲染该pdf。")])]),n._v(" "),e("h3",{attrs:{id:"关键代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关键代码"}},[n._v("#")]),n._v(" 关键代码")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('<pdf\n      v-for="number of total"\n      :src="source(number)"\n      :id="number"\n      :page="number"\n      :key="number"\n></pdf>\n')])])]),e("p",[n._v("将src变为计算属性"),e("code",[n._v("source")])]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v(" computed: {\n    source () {\n      return (index) => {\n        return index > this.curIndex ? {} : this.files\n      }\n    }\n  },\n    lazyLoad () {\n      var seeHeight = document.documentElement.clientHeight; //可见区域高度\n      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n      // 循环所有pdf\n      for (let i = this.curIndex; i < this.total; i++) {\n        let dom = document.getElementById(i)\n        // 当pdf暴露到视口时，将pdf渲染\n        if (dom.offsetTop < seeHeight + scrollTop) {\n          this.curIndex = i + 1\n        }\n      }\n    },\n")])])]),e("p",[n._v("完成之后最好加上节流，优化性能")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("throttle (context, fn, ...args) {\n      let timer = null\n      return function () {\n        if (timer) return\n        timer = setTimeout(() => {\n          fn.apply(context, args)\n          timer = null\n        }, 300);\n      }\n    }\n")])])]),e("h3",{attrs:{id:"完整代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#完整代码"}},[n._v("#")]),n._v(" 完整代码")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('<template>\n  <div class="container">\n    <pdf\n      v-for="number of total"\n      :src="source(number)"\n      :id="number"\n      :page="number"\n      :key="number"\n    ></pdf>\n  </div>\n\n</template>\n<script>\nimport pdf from \'vue-pdf\'\nexport default {\n  name: \'pdfs\',\n  data () {\n    return {\n      src: \'https://server.custouch.com/Corp/10007/1000702/Media/Attach/Kuka/files/KSS_52_53_54_END_zh.pdf\',\n      files: {},\n      page: 1,\n      total: undefined,\n      curIndex: 1\n    }\n  },\n  components: {\n    pdf,\n  },\n  computed: {\n    source () {\n      return (index) => {\n        return index > this.curIndex ? {} : this.files\n      }\n    }\n  },\n  mounted () {\n    this.files = pdf.createLoadingTask(this.src)\n    this.files.then(pdf => {\n      this.total = pdf.numPages\n    })\n    window.addEventListener(\'scroll\', this.throttle(this, this.lazyLoad), true)\n  },\n  methods: {\n    lazyLoad () {\n      var seeHeight = document.documentElement.clientHeight; //可见区域高度\n      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop; //滚动条距离顶部高度\n      // 循环所有pdf\n      for (let i = this.curIndex; i < this.total; i++) {\n        let dom = document.getElementById(i)\n        // 当pdf暴露到视口时，将pdf渲染\n        if (dom.offsetTop < seeHeight + scrollTop) {\n          this.curIndex = i + 1\n        }\n      }\n    },\n    throttle (context, fn, ...args) {\n      let timer = null\n      return function () {\n        if (timer) return\n        timer = setTimeout(() => {\n          fn.apply(context, args)\n          timer = null\n        }, 300);\n      }\n    }\n  },\n}\n<\/script>\n\n<style scoped>\n</style>\n')])])])])}),[],!1,null,null,null);t.default=s.exports}}]);